<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odd Meter Metronome</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #000000;
                color: #ffffff;
            }
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 50px;
            padding: 40px;
        }

        .metronome-container {
            position: relative;
            width: 300px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .metronome-base {
            position: absolute;
            bottom: 0;
            width: 120px;
            height: 20px;
            background: rgba(128, 128, 128, 0.2);
            border-radius: 20px;
        }

        .pivot-point {
            position: absolute;
            top: 90px;
            width: 12px;
            height: 12px;
            background: currentColor;
            border-radius: 50%;
            z-index: 10;
        }

        .pendulum {
            position: absolute;
            top: 90px;
            transform-origin: center top;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.1s ease-in-out;
        }

        .pendulum-rod {
            width: 4px;
            height: 180px;
            background: currentColor;
        }

        .pendulum-weight {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007AFF, #AF52DE);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            margin-top: -2px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .bpm-display {
            font-size: 80px;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            transition: all 0.2s ease-in-out;
        }

        .bpm-controls {
            display: flex;
            gap: 50px;
            align-items: center;
        }

        .bpm-button {
            background: none;
            border: none;
            color: currentColor;
            font-size: 40px;
            cursor: pointer;
            padding: 10px;
            transition: opacity 0.2s;
        }

        .bpm-button:hover:not(:disabled) {
            opacity: 0.7;
        }

        .bpm-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .play-pause-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid;
            background: rgba(0, 0, 0, 0.05);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: all 0.2s;
        }

        .play-pause-button:hover {
            transform: scale(1.05);
        }

        .play-pause-button.playing {
            border-color: #ff3b30;
            color: #ff3b30;
            background: rgba(255, 59, 48, 0.1);
        }

        .play-pause-button.paused {
            border-color: #34c759;
            color: #34c759;
            background: rgba(52, 199, 89, 0.1);
        }

        @media (prefers-color-scheme: dark) {
            .play-pause-button {
                background: rgba(255, 255, 255, 0.05);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="metronome-container">
            <div class="metronome-base"></div>
            <div class="pivot-point"></div>
            <div class="pendulum" id="pendulum">
                <div class="pendulum-rod"></div>
                <div class="pendulum-weight"></div>
            </div>
        </div>

        <div class="controls">
            <div class="bpm-display" id="bpmDisplay">120</div>
            
            <div class="bpm-controls">
                <button class="bpm-button" id="decreaseBtn">−</button>
                <button class="bpm-button" id="increaseBtn">+</button>
            </div>

            <button class="play-pause-button paused" id="playPauseBtn">
                ▶
            </button>
        </div>
    </div>

    <script>
        let bpm = 120;
        let isPlaying = false;
        let animationId = null;
        let currentAngle = -30;
        let targetAngle = 30;
        let animationStartTime = null;
        let swingDuration = 0;

        const minBPM = 30;
        const maxBPM = 300;

        const pendulum = document.getElementById('pendulum');
        const bpmDisplay = document.getElementById('bpmDisplay');
        const decreaseBtn = document.getElementById('decreaseBtn');
        const increaseBtn = document.getElementById('increaseBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');

        function updateBPMDisplay() {
            bpmDisplay.textContent = bpm;
        }

        function updateButtonStates() {
            decreaseBtn.disabled = bpm <= minBPM;
            increaseBtn.disabled = bpm >= maxBPM;
        }

        function calculateSwingDuration() {
            return (60.0 / bpm) / 2; // Half beat for one direction
        }

        function animatePendulum(timestamp) {
            if (!isPlaying) {
                // Return to center
                currentAngle = 0;
                pendulum.style.transform = `rotate(${currentAngle}deg)`;
                return;
            }

            if (animationStartTime === null) {
                animationStartTime = timestamp;
                swingDuration = calculateSwingDuration() * 1000; // Convert to milliseconds
                currentAngle = -30;
                targetAngle = 30;
            }

            const elapsed = timestamp - animationStartTime;
            const progress = Math.min(elapsed / swingDuration, 1);

            // Ease in-out function
            const easeProgress = progress < 0.5
                ? 2 * progress * progress
                : 1 - Math.pow(-2 * progress + 2, 2) / 2;

            const angle = currentAngle + (targetAngle - currentAngle) * easeProgress;
            pendulum.style.transform = `rotate(${angle}deg)`;

            if (progress >= 1) {
                // Switch direction
                const temp = currentAngle;
                currentAngle = targetAngle;
                targetAngle = temp;
                animationStartTime = timestamp;
            }

            animationId = requestAnimationFrame(animatePendulum);
        }

        function startMetronome() {
            isPlaying = true;
            animationStartTime = null;
            playPauseBtn.textContent = '⏸';
            playPauseBtn.classList.remove('paused');
            playPauseBtn.classList.add('playing');
            animationId = requestAnimationFrame(animatePendulum);
        }

        function stopMetronome() {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            playPauseBtn.textContent = '▶';
            playPauseBtn.classList.remove('playing');
            playPauseBtn.classList.add('paused');
            
            // Smoothly return to center
            const startAngle = currentAngle;
            const startTime = performance.now();
            const duration = 300; // 300ms to return to center

            function returnToCenter(timestamp) {
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = 1 - Math.pow(1 - progress, 3); // Ease out
                const angle = startAngle * (1 - easeProgress);
                pendulum.style.transform = `rotate(${angle}deg)`;

                if (progress < 1) {
                    requestAnimationFrame(returnToCenter);
                } else {
                    currentAngle = 0;
                }
            }
            requestAnimationFrame(returnToCenter);
        }

        function toggleMetronome() {
            if (isPlaying) {
                stopMetronome();
            } else {
                startMetronome();
            }
        }

        function increaseBPM() {
            if (bpm < maxBPM) {
                bpm = Math.min(bpm + 1, maxBPM);
                updateBPMDisplay();
                updateButtonStates();
                if (isPlaying) {
                    restartMetronome();
                }
            }
        }

        function decreaseBPM() {
            if (bpm > minBPM) {
                bpm = Math.max(bpm - 1, minBPM);
                updateBPMDisplay();
                updateButtonStates();
                if (isPlaying) {
                    restartMetronome();
                }
            }
        }

        function restartMetronome() {
            const wasPlaying = isPlaying;
            stopMetronome();
            if (wasPlaying) {
                setTimeout(() => {
                    startMetronome();
                }, 100);
            }
        }

        // Event listeners
        playPauseBtn.addEventListener('click', toggleMetronome);
        increaseBtn.addEventListener('click', increaseBPM);
        decreaseBtn.addEventListener('click', decreaseBPM);

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' || e.key === '+') {
                increaseBPM();
            } else if (e.key === 'ArrowDown' || e.key === '-') {
                decreaseBPM();
            } else if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                toggleMetronome();
            }
        });

        // Initialize
        updateButtonStates();
    </script>
</body>
</html>





